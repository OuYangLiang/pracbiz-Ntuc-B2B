<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pracbiz.b2bportal.core.mapper.InvHeaderMapper" >
  <resultMap id="BaseResultMap" type="com.pracbiz.b2bportal.core.holder.InvHeaderHolder" >
    <id column="INV_OID" property="invOid" jdbcType="DECIMAL" />
    <result column="INV_NO" property="invNo" jdbcType="VARCHAR" />
    <result column="DOC_ACTION" property="docAction" jdbcType="CHAR" />
    <result column="ACTION_DATE" property="actionDate" jdbcType="TIMESTAMP" />
    <result column="INV_TYPE" property="invType" jdbcType="CHAR" />
    <result column="INV_DATE" property="invDate" jdbcType="TIMESTAMP" />
    <result column="PO_NO" property="poNo" jdbcType="VARCHAR" />
    <result column="PO_DATE" property="poDate" jdbcType="DATE" />
    <result column="DELIVERY_DATE" property="deliveryDate" jdbcType="TIMESTAMP" />
    <result column="BUYER_OID" property="buyerOid" jdbcType="DECIMAL" />
    <result column="BUYER_CODE" property="buyerCode" jdbcType="VARCHAR" />
    <result column="BUYER_NAME" property="buyerName" jdbcType="VARCHAR" />
    <result column="BUYER_ADDR1" property="buyerAddr1" jdbcType="VARCHAR" />
    <result column="BUYER_ADDR2" property="buyerAddr2" jdbcType="VARCHAR" />
    <result column="BUYER_ADDR3" property="buyerAddr3" jdbcType="VARCHAR" />
    <result column="BUYER_ADDR4" property="buyerAddr4" jdbcType="VARCHAR" />
    <result column="BUYER_CITY" property="buyerCity" jdbcType="VARCHAR" />
    <result column="BUYER_STATE" property="buyerState" jdbcType="VARCHAR" />
    <result column="BUYER_CTRY_CODE" property="buyerCtryCode" jdbcType="CHAR" />
    <result column="BUYER_POSTAL_CODE" property="buyerPostalCode" jdbcType="VARCHAR" />
    <result column="DEPT_CODE" property="deptCode" jdbcType="VARCHAR" />
    <result column="DEPT_NAME" property="deptName" jdbcType="VARCHAR" />
    <result column="SUB_DEPT_CODE" property="subDeptCode" jdbcType="VARCHAR" />
    <result column="SUB_DEPT_NAME" property="subDeptName" jdbcType="VARCHAR" />
    <result column="SUPPLIER_OID" property="supplierOid" jdbcType="DECIMAL" />
    <result column="SUPPLIER_CODE" property="supplierCode" jdbcType="VARCHAR" />
    <result column="SUPPLIER_NAME" property="supplierName" jdbcType="VARCHAR" />
    <result column="SUPPLIER_ADDR1" property="supplierAddr1" jdbcType="VARCHAR" />
    <result column="SUPPLIER_ADDR2" property="supplierAddr2" jdbcType="VARCHAR" />
    <result column="SUPPLIER_ADDR3" property="supplierAddr3" jdbcType="VARCHAR" />
    <result column="SUPPLIER_ADDR4" property="supplierAddr4" jdbcType="VARCHAR" />
    <result column="SUPPLIER_CITY" property="supplierCity" jdbcType="VARCHAR" />
    <result column="SUPPLIER_STATE" property="supplierState" jdbcType="VARCHAR" />
    <result column="SUPPLIER_CTRY_CODE" property="supplierCtryCode" jdbcType="CHAR" />
    <result column="SUPPLIER_POSTAL_CODE" property="supplierPostalCode" jdbcType="VARCHAR" />
    <result column="SHIP_TO_CODE" property="shipToCode" jdbcType="VARCHAR" />
    <result column="SHIP_TO_NAME" property="shipToName" jdbcType="VARCHAR" />
    <result column="SHIP_TO_ADDR1" property="shipToAddr1" jdbcType="VARCHAR" />
    <result column="SHIP_TO_ADDR2" property="shipToAddr2" jdbcType="VARCHAR" />
    <result column="SHIP_TO_ADDR3" property="shipToAddr3" jdbcType="VARCHAR" />
    <result column="SHIP_TO_ADDR4" property="shipToAddr4" jdbcType="VARCHAR" />
    <result column="SHIP_TO_CITY" property="shipToCity" jdbcType="VARCHAR" />
    <result column="SHIP_TO_STATE" property="shipToState" jdbcType="VARCHAR" />
    <result column="SHIP_TO_CTRY_CODE" property="shipToCtryCode" jdbcType="CHAR" />
    <result column="SHIP_TO_POSTAL_CODE" property="shipToPostalCode" jdbcType="VARCHAR" />
    <result column="PAY_TERM_CODE" property="payTermCode" jdbcType="VARCHAR" />
    <result column="PAY_TERM_DESC" property="payTermDesc" jdbcType="VARCHAR" />
    <result column="PAY_INSTRUCT" property="payInstruct" jdbcType="VARCHAR" />
    <result column="ADDITIONAL_DISCOUNT_AMOUNT" property="additionalDiscountAmount" jdbcType="DECIMAL" />
    <result column="ADDITIONAL_DISCOUNT_PERCENT" property="additionalDiscountPercent" jdbcType="DECIMAL" />
    <result column="CASH_DISCOUNT_AMOUNT" property="cashDiscountAmount" jdbcType="DECIMAL" />
    <result column="CASH_DISCOUNT_PERCENT" property="cashDiscountPercent" jdbcType="DECIMAL" />
    <result column="INV_AMOUNT_NO_VAT" property="invAmountNoVat" jdbcType="DECIMAL" />
    <result column="VAT_AMOUNT" property="vatAmount" jdbcType="DECIMAL" />
    <result column="INV_AMOUNT_WITH_VAT" property="invAmountWithVat" jdbcType="DECIMAL" />
    <result column="VAT_RATE" property="vatRate" jdbcType="DECIMAL" />
    <result column="INV_REMARKS" property="invRemarks" jdbcType="VARCHAR" />
    <result column="PO_OID" property="poOid" jdbcType="DECIMAL" />
    <result column="FOOTER_LINE_1" property="footerLine1" jdbcType="VARCHAR"/>
    <result column="FOOTER_LINE_2" property="footerLine2" jdbcType="VARCHAR"/>
    <result column="FOOTER_LINE_3" property="footerLine3" jdbcType="VARCHAR"/>
    <result column="FOOTER_LINE_4" property="footerLine4" jdbcType="VARCHAR"/>
    <result column="CTRL_STATUS" property="invStatus" jdbcType="CHAR"/>
    <result column="OLD_INV_NO" property="oldInvNo" jdbcType="VARCHAR"/>
    <result column="DELIVERY_NO" property="deliveryNo" jdbcType="VARCHAR"/>
  </resultMap>
  <sql id="Base_Column_List" >
    INV_OID, INV_NO, DOC_ACTION, ACTION_DATE, INV_TYPE, INV_DATE, PO_NO, PO_DATE, DELIVERY_DATE, 
    BUYER_OID, BUYER_CODE, BUYER_NAME, BUYER_ADDR1, BUYER_ADDR2, BUYER_ADDR3, BUYER_ADDR4, 
    BUYER_CITY, BUYER_STATE, BUYER_CTRY_CODE, BUYER_POSTAL_CODE, DEPT_CODE, DEPT_NAME, 
    SUB_DEPT_CODE, SUB_DEPT_NAME, SUPPLIER_OID, SUPPLIER_CODE, SUPPLIER_NAME, SUPPLIER_ADDR1, 
    SUPPLIER_ADDR2, SUPPLIER_ADDR3, SUPPLIER_ADDR4, SUPPLIER_CITY, SUPPLIER_STATE, SUPPLIER_CTRY_CODE, 
    SUPPLIER_POSTAL_CODE, SHIP_TO_CODE, SHIP_TO_NAME, SHIP_TO_ADDR1, SHIP_TO_ADDR2, SHIP_TO_ADDR3, 
    SHIP_TO_ADDR4, SHIP_TO_CITY, SHIP_TO_STATE, SHIP_TO_CTRY_CODE, SHIP_TO_POSTAL_CODE, 
    PAY_TERM_CODE, PAY_TERM_DESC, PAY_INSTRUCT, ADDITIONAL_DISCOUNT_AMOUNT, ADDITIONAL_DISCOUNT_PERCENT, 
    INV_AMOUNT_NO_VAT, VAT_AMOUNT, INV_AMOUNT_WITH_VAT, VAT_RATE, INV_REMARKS, PO_OID,FOOTER_LINE_1,
    FOOTER_LINE_2,FOOTER_LINE_3,FOOTER_LINE_4,CTRL_STATUS, CASH_DISCOUNT_AMOUNT, CASH_DISCOUNT_PERCENT,
    OLD_INV_NO, DELIVERY_NO
  </sql>
  <select id="select" resultMap="BaseResultMap" parameterType="com.pracbiz.b2bportal.core.holder.InvHeaderHolder" >
    select 
    <include refid="Base_Column_List" />
    from INV_HEADER
    <where>
      <if test="invOid != null" >
        INV_OID = #{invOid,jdbcType=DECIMAL}
      </if>
      <if test="invNo != null" >
        and INV_NO = #{invNo,jdbcType=VARCHAR}
      </if>
      <if test="docAction != null" >
        and DOC_ACTION = #{docAction,jdbcType=CHAR}
      </if>
      <if test="actionDate != null" >
        and ACTION_DATE = #{actionDate,jdbcType=TIMESTAMP}
      </if>
      <if test="invType != null" >
        and INV_TYPE = #{invType,jdbcType=CHAR}
      </if>
      <if test="invDate != null" >
        and INV_DATE = #{invDate,jdbcType=TIMESTAMP}
      </if>
      <if test="poNo != null" >
        and PO_NO = #{poNo,jdbcType=VARCHAR}
      </if>
      <if test="poDate != null" >
        and PO_DATE = #{poDate,jdbcType=DATE}
      </if>
      <if test="deliveryDate != null" >
        and DELIVERY_DATE = #{deliveryDate,jdbcType=TIMESTAMP}
      </if>
      <if test="buyerOid != null" >
        and BUYER_OID = #{buyerOid,jdbcType=DECIMAL}
      </if>
      <if test="buyerCode != null" >
        and BUYER_CODE = #{buyerCode,jdbcType=VARCHAR}
      </if>
      <if test="buyerName != null" >
        and BUYER_NAME = #{buyerName,jdbcType=VARCHAR}
      </if>
      <if test="buyerAddr1 != null" >
        and BUYER_ADDR1 = #{buyerAddr1,jdbcType=VARCHAR}
      </if>
      <if test="buyerAddr2 != null" >
        and BUYER_ADDR2 = #{buyerAddr2,jdbcType=VARCHAR}
      </if>
      <if test="buyerAddr3 != null" >
        and BUYER_ADDR3 = #{buyerAddr3,jdbcType=VARCHAR}
      </if>
      <if test="buyerAddr4 != null" >
        and BUYER_ADDR4 = #{buyerAddr4,jdbcType=VARCHAR}
      </if>
      <if test="buyerCity != null" >
        and BUYER_CITY = #{buyerCity,jdbcType=VARCHAR}
      </if>
      <if test="buyerState != null" >
        and BUYER_STATE = #{buyerState,jdbcType=VARCHAR}
      </if>
      <if test="buyerCtryCode != null" >
        and BUYER_CTRY_CODE = #{buyerCtryCode,jdbcType=CHAR}
      </if>
      <if test="buyerPostalCode != null" >
        and BUYER_POSTAL_CODE = #{buyerPostalCode,jdbcType=VARCHAR}
      </if>
      <if test="deptCode != null" >
        and DEPT_CODE = #{deptCode,jdbcType=VARCHAR}
      </if>
      <if test="deptName != null" >
        and DEPT_NAME = #{deptName,jdbcType=VARCHAR}
      </if>
      <if test="subDeptCode != null" >
        and SUB_DEPT_CODE = #{subDeptCode,jdbcType=VARCHAR}
      </if>
      <if test="subDeptName != null" >
        and SUB_DEPT_NAME = #{subDeptName,jdbcType=VARCHAR}
      </if>
      <if test="supplierOid != null" >
        and SUPPLIER_OID = #{supplierOid,jdbcType=DECIMAL}
      </if>
      <if test="supplierCode != null" >
        and SUPPLIER_CODE = #{supplierCode,jdbcType=VARCHAR}
      </if>
      <if test="supplierName != null" >
        and SUPPLIER_NAME = #{supplierName,jdbcType=VARCHAR}
      </if>
      <if test="supplierAddr1 != null" >
        and SUPPLIER_ADDR1 = #{supplierAddr1,jdbcType=VARCHAR}
      </if>
      <if test="supplierAddr2 != null" >
        and SUPPLIER_ADDR2 = #{supplierAddr2,jdbcType=VARCHAR}
      </if>
      <if test="supplierAddr3 != null" >
        and SUPPLIER_ADDR3 = #{supplierAddr3,jdbcType=VARCHAR}
      </if>
      <if test="supplierAddr4 != null" >
        and SUPPLIER_ADDR4 = #{supplierAddr4,jdbcType=VARCHAR}
      </if>
      <if test="supplierCity != null" >
        and SUPPLIER_CITY = #{supplierCity,jdbcType=VARCHAR}
      </if>
      <if test="supplierState != null" >
        and SUPPLIER_STATE = #{supplierState,jdbcType=VARCHAR}
      </if>
      <if test="supplierCtryCode != null" >
        and SUPPLIER_CTRY_CODE = #{supplierCtryCode,jdbcType=CHAR}
      </if>
      <if test="supplierPostalCode != null" >
        and SUPPLIER_POSTAL_CODE = #{supplierPostalCode,jdbcType=VARCHAR}
      </if>
      <if test="shipToCode != null" >
        and SHIP_TO_CODE = #{shipToCode,jdbcType=VARCHAR}
      </if>
      <if test="shipToName != null" >
        and SHIP_TO_NAME = #{shipToName,jdbcType=VARCHAR}
      </if>
      <if test="shipToAddr1 != null" >
        and SHIP_TO_ADDR1 = #{shipToAddr1,jdbcType=VARCHAR}
      </if>
      <if test="shipToAddr2 != null" >
        and SHIP_TO_ADDR2 = #{shipToAddr2,jdbcType=VARCHAR}
      </if>
      <if test="shipToAddr3 != null" >
        and SHIP_TO_ADDR3 = #{shipToAddr3,jdbcType=VARCHAR}
      </if>
      <if test="shipToAddr4 != null" >
        and SHIP_TO_ADDR4 = #{shipToAddr4,jdbcType=VARCHAR}
      </if>
      <if test="shipToCity != null" >
        and SHIP_TO_CITY = #{shipToCity,jdbcType=VARCHAR}
      </if>
      <if test="shipToState != null" >
        and SHIP_TO_STATE = #{shipToState,jdbcType=VARCHAR}
      </if>
      <if test="shipToCtryCode != null" >
        and SHIP_TO_CTRY_CODE = #{shipToCtryCode,jdbcType=CHAR}
      </if>
      <if test="shipToPostalCode != null" >
        and SHIP_TO_POSTAL_CODE = #{shipToPostalCode,jdbcType=VARCHAR}
      </if>
      <if test="payTermCode != null" >
        and PAY_TERM_CODE = #{payTermCode,jdbcType=VARCHAR}
      </if>
      <if test="payTermDesc != null" >
        and PAY_TERM_DESC = #{payTermDesc,jdbcType=VARCHAR}
      </if>
      <if test="payInstruct != null" >
        and PAY_INSTRUCT = #{payInstruct,jdbcType=VARCHAR}
      </if>
      <if test="additionalDiscountAmount != null" >
        and ADDITIONAL_DISCOUNT_AMOUNT = #{additionalDiscountAmount,jdbcType=DECIMAL}
      </if>
      <if test="additionalDiscountPercent != null" >
        and ADDITIONAL_DISCOUNT_PERCENT = #{additionalDiscountPercent,jdbcType=DECIMAL}
      </if>
      <if test="invAmountNoVat != null" >
        and INV_AMOUNT_NO_VAT = #{invAmountNoVat,jdbcType=DECIMAL}
      </if>
      <if test="vatAmount != null" >
        and VAT_AMOUNT = #{vatAmount,jdbcType=DECIMAL}
      </if>
      <if test="invAmountWithVat != null" >
        and INV_AMOUNT_WITH_VAT = #{invAmountWithVat,jdbcType=DECIMAL}
      </if>
      <if test="vatRate != null" >
        and VAT_RATE = #{vatRate,jdbcType=DECIMAL}
      </if>
      <if test="invRemarks != null" >
        and INV_REMARKS = #{invRemarks,jdbcType=VARCHAR}
      </if>
      <if test="poOid != null" >
        and PO_OID = #{poOid,jdbcType=DECIMAL}
      </if>
      <if test="invStatus != null">
      	and CTRL_STATUS = #{invStatus,jdbcType=CHAR}
      </if>
      <if test="deliveryNo != null">
      	and DELIVERY_NO = #{deliveryNo,jdbcType=VARCHAR}
      </if>
    </where>
  </select>
  <select id="selectInvToGenerateDn" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT * FROM INV_HEADER I, PO_INV_GRN_DN_MATCHING M WHERE I.INV_OID = M.INV_OID AND M.DN_OID IS NULL
	AND M.MATCHING_STATUS IN ('QTY_UNMATCHED','PRICE_UNMATCHED') AND M.CLOSED = FALSE AND DATEDIFF(NOW(), M.MATCHING_DATE) 
	<![CDATA[<=]]> #{minBufferDays, jdbcType=INTEGER} AND  DATEDIFF(NOW(), M.MATCHING_DATE) <![CDATA[<=]]> #{maxBufferDays, jdbcType=INTEGER} 
	AND NOT EXISTS (SELECT 1 FROM DN_HEADER D WHERE I.INV_NO = D.INV_NO AND I.BUYER_CODE = D.BUYER_CODE AND I.SUPPLIER_CODE = D.SUPPLIER_CODE
	AND D.CTRL_STATUS !='OUTDATED');
  </select>
  <delete id="delete" parameterType="com.pracbiz.b2bportal.core.holder.InvHeaderHolder" >
    delete from INV_HEADER
    <where>
      <if test="invOid != null" >
        INV_OID = #{invOid,jdbcType=DECIMAL}
      </if>
      <if test="invNo != null" >
        and INV_NO = #{invNo,jdbcType=VARCHAR}
      </if>
      <if test="docAction != null" >
        and DOC_ACTION = #{docAction,jdbcType=CHAR}
      </if>
      <if test="actionDate != null" >
        and ACTION_DATE = #{actionDate,jdbcType=TIMESTAMP}
      </if>
      <if test="invType != null" >
        and INV_TYPE = #{invType,jdbcType=CHAR}
      </if>
      <if test="invDate != null" >
        and INV_DATE = #{invDate,jdbcType=TIMESTAMP}
      </if>
      <if test="poNo != null" >
        and PO_NO = #{poNo,jdbcType=VARCHAR}
      </if>
      <if test="poDate != null" >
        and PO_DATE = #{poDate,jdbcType=DATE}
      </if>
      <if test="deliveryDate != null" >
        and DELIVERY_DATE = #{deliveryDate,jdbcType=TIMESTAMP}
      </if>
      <if test="buyerOid != null" >
        and BUYER_OID = #{buyerOid,jdbcType=DECIMAL}
      </if>
      <if test="buyerCode != null" >
        and BUYER_CODE = #{buyerCode,jdbcType=VARCHAR}
      </if>
      <if test="buyerName != null" >
        and BUYER_NAME = #{buyerName,jdbcType=VARCHAR}
      </if>
      <if test="buyerAddr1 != null" >
        and BUYER_ADDR1 = #{buyerAddr1,jdbcType=VARCHAR}
      </if>
      <if test="buyerAddr2 != null" >
        and BUYER_ADDR2 = #{buyerAddr2,jdbcType=VARCHAR}
      </if>
      <if test="buyerAddr3 != null" >
        and BUYER_ADDR3 = #{buyerAddr3,jdbcType=VARCHAR}
      </if>
      <if test="buyerAddr4 != null" >
        and BUYER_ADDR4 = #{buyerAddr4,jdbcType=VARCHAR}
      </if>
      <if test="buyerCity != null" >
        and BUYER_CITY = #{buyerCity,jdbcType=VARCHAR}
      </if>
      <if test="buyerState != null" >
        and BUYER_STATE = #{buyerState,jdbcType=VARCHAR}
      </if>
      <if test="buyerCtryCode != null" >
        and BUYER_CTRY_CODE = #{buyerCtryCode,jdbcType=CHAR}
      </if>
      <if test="buyerPostalCode != null" >
        and BUYER_POSTAL_CODE = #{buyerPostalCode,jdbcType=VARCHAR}
      </if>
      <if test="deptCode != null" >
        and DEPT_CODE = #{deptCode,jdbcType=VARCHAR}
      </if>
      <if test="deptName != null" >
        and DEPT_NAME = #{deptName,jdbcType=VARCHAR}
      </if>
      <if test="subDeptCode != null" >
        and SUB_DEPT_CODE = #{subDeptCode,jdbcType=VARCHAR}
      </if>
      <if test="subDeptName != null" >
        and SUB_DEPT_NAME = #{subDeptName,jdbcType=VARCHAR}
      </if>
      <if test="supplierOid != null" >
        and SUPPLIER_OID = #{supplierOid,jdbcType=DECIMAL}
      </if>
      <if test="supplierCode != null" >
        and SUPPLIER_CODE = #{supplierCode,jdbcType=VARCHAR}
      </if>
      <if test="supplierName != null" >
        and SUPPLIER_NAME = #{supplierName,jdbcType=VARCHAR}
      </if>
      <if test="supplierAddr1 != null" >
        and SUPPLIER_ADDR1 = #{supplierAddr1,jdbcType=VARCHAR}
      </if>
      <if test="supplierAddr2 != null" >
        and SUPPLIER_ADDR2 = #{supplierAddr2,jdbcType=VARCHAR}
      </if>
      <if test="supplierAddr3 != null" >
        and SUPPLIER_ADDR3 = #{supplierAddr3,jdbcType=VARCHAR}
      </if>
      <if test="supplierAddr4 != null" >
        and SUPPLIER_ADDR4 = #{supplierAddr4,jdbcType=VARCHAR}
      </if>
      <if test="supplierCity != null" >
        and SUPPLIER_CITY = #{supplierCity,jdbcType=VARCHAR}
      </if>
      <if test="supplierState != null" >
        and SUPPLIER_STATE = #{supplierState,jdbcType=VARCHAR}
      </if>
      <if test="supplierCtryCode != null" >
        and SUPPLIER_CTRY_CODE = #{supplierCtryCode,jdbcType=CHAR}
      </if>
      <if test="supplierPostalCode != null" >
        and SUPPLIER_POSTAL_CODE = #{supplierPostalCode,jdbcType=VARCHAR}
      </if>
      <if test="shipToCode != null" >
        and SHIP_TO_CODE = #{shipToCode,jdbcType=VARCHAR}
      </if>
      <if test="shipToName != null" >
        and SHIP_TO_NAME = #{shipToName,jdbcType=VARCHAR}
      </if>
      <if test="shipToAddr1 != null" >
        and SHIP_TO_ADDR1 = #{shipToAddr1,jdbcType=VARCHAR}
      </if>
      <if test="shipToAddr2 != null" >
        and SHIP_TO_ADDR2 = #{shipToAddr2,jdbcType=VARCHAR}
      </if>
      <if test="shipToAddr3 != null" >
        and SHIP_TO_ADDR3 = #{shipToAddr3,jdbcType=VARCHAR}
      </if>
      <if test="shipToAddr4 != null" >
        and SHIP_TO_ADDR4 = #{shipToAddr4,jdbcType=VARCHAR}
      </if>
      <if test="shipToCity != null" >
        and SHIP_TO_CITY = #{shipToCity,jdbcType=VARCHAR}
      </if>
      <if test="shipToState != null" >
        and SHIP_TO_STATE = #{shipToState,jdbcType=VARCHAR}
      </if>
      <if test="shipToCtryCode != null" >
        and SHIP_TO_CTRY_CODE = #{shipToCtryCode,jdbcType=CHAR}
      </if>
      <if test="shipToPostalCode != null" >
        and SHIP_TO_POSTAL_CODE = #{shipToPostalCode,jdbcType=VARCHAR}
      </if>
      <if test="payTermCode != null" >
        and PAY_TERM_CODE = #{payTermCode,jdbcType=VARCHAR}
      </if>
      <if test="payTermDesc != null" >
        and PAY_TERM_DESC = #{payTermDesc,jdbcType=VARCHAR}
      </if>
      <if test="payInstruct != null" >
        and PAY_INSTRUCT = #{payInstruct,jdbcType=VARCHAR}
      </if>
      <if test="additionalDiscountAmount != null" >
        and ADDITIONAL_DISCOUNT_AMOUNT = #{additionalDiscountAmount,jdbcType=DECIMAL}
      </if>
      <if test="additionalDiscountPercent != null" >
        and ADDITIONAL_DISCOUNT_PERCENT = #{additionalDiscountPercent,jdbcType=DECIMAL}
      </if>
      <if test="cashDiscountAmount != null" >
        and CASH_DISCOUNT_AMOUNT = #{cashDiscountAmount,jdbcType=DECIMAL}
      </if>
      <if test="cashDiscountPercent != null" >
        and CASH_DISCOUNT_PERCENT = #{cashDiscountPercent,jdbcType=DECIMAL}
      </if>
      <if test="invAmountNoVat != null" >
        and INV_AMOUNT_NO_VAT = #{invAmountNoVat,jdbcType=DECIMAL}
      </if>
      <if test="vatAmount != null" >
        and VAT_AMOUNT = #{vatAmount,jdbcType=DECIMAL}
      </if>
      <if test="invAmountWithVat != null" >
        and INV_AMOUNT_WITH_VAT = #{invAmountWithVat,jdbcType=DECIMAL}
      </if>
      <if test="vatRate != null" >
        and VAT_RATE = #{vatRate,jdbcType=DECIMAL}
      </if>
      <if test="invRemarks != null" >
        and INV_REMARKS = #{invRemarks,jdbcType=VARCHAR}
      </if>
      <if test="poOid != null" >
        and PO_OID = #{poOid,jdbcType=DECIMAL}
      </if>
      <if test="invStatus != null">
      	and CTRL_STATUS = #{invStatus,jdbcType=CHAR}
      </if>
      <if test="deliveryNo != null">
      	and DELIVERY_NO = #{deliveryNo,jdbcType=VARCHAR}
      </if>
    </where>
  </delete>
  <insert id="insert" parameterType="com.pracbiz.b2bportal.core.holder.InvHeaderHolder" >
    insert into INV_HEADER (INV_OID, INV_NO, DOC_ACTION, 
      ACTION_DATE, INV_TYPE, INV_DATE, 
      PO_NO, PO_DATE, DELIVERY_DATE, 
      BUYER_OID, BUYER_CODE, BUYER_NAME, 
      BUYER_ADDR1, BUYER_ADDR2, BUYER_ADDR3, 
      BUYER_ADDR4, BUYER_CITY, BUYER_STATE, 
      BUYER_CTRY_CODE, BUYER_POSTAL_CODE, DEPT_CODE, 
      DEPT_NAME, SUB_DEPT_CODE, SUB_DEPT_NAME, 
      SUPPLIER_OID, SUPPLIER_CODE, SUPPLIER_NAME, 
      SUPPLIER_ADDR1, SUPPLIER_ADDR2, SUPPLIER_ADDR3, 
      SUPPLIER_ADDR4, SUPPLIER_CITY, SUPPLIER_STATE, 
      SUPPLIER_CTRY_CODE, SUPPLIER_POSTAL_CODE, SHIP_TO_CODE, 
      SHIP_TO_NAME, SHIP_TO_ADDR1, SHIP_TO_ADDR2, 
      SHIP_TO_ADDR3, SHIP_TO_ADDR4, SHIP_TO_CITY, 
      SHIP_TO_STATE, SHIP_TO_CTRY_CODE, SHIP_TO_POSTAL_CODE, 
      PAY_TERM_CODE, PAY_TERM_DESC, PAY_INSTRUCT, 
      ADDITIONAL_DISCOUNT_AMOUNT, ADDITIONAL_DISCOUNT_PERCENT, 
      CASH_DISCOUNT_AMOUNT, CASH_DISCOUNT_PERCENT, 
      INV_AMOUNT_NO_VAT, VAT_AMOUNT, INV_AMOUNT_WITH_VAT, 
      VAT_RATE, INV_REMARKS, PO_OID, FOOTER_LINE_1,
      FOOTER_LINE_2,FOOTER_LINE_3,FOOTER_LINE_4,CTRL_STATUS,
      OLD_INV_NO, DELIVERY_NO
      )
    values (#{invOid,jdbcType=DECIMAL}, #{invNo,jdbcType=VARCHAR}, #{docAction,jdbcType=CHAR}, 
      #{actionDate,jdbcType=TIMESTAMP}, #{invType,jdbcType=CHAR}, #{invDate,jdbcType=TIMESTAMP}, 
      #{poNo,jdbcType=VARCHAR}, #{poDate,jdbcType=DATE}, #{deliveryDate,jdbcType=TIMESTAMP}, 
      #{buyerOid,jdbcType=DECIMAL}, #{buyerCode,jdbcType=VARCHAR}, #{buyerName,jdbcType=VARCHAR}, 
      #{buyerAddr1,jdbcType=VARCHAR}, #{buyerAddr2,jdbcType=VARCHAR}, #{buyerAddr3,jdbcType=VARCHAR}, 
      #{buyerAddr4,jdbcType=VARCHAR}, #{buyerCity,jdbcType=VARCHAR}, #{buyerState,jdbcType=VARCHAR}, 
      #{buyerCtryCode,jdbcType=CHAR}, #{buyerPostalCode,jdbcType=VARCHAR}, #{deptCode,jdbcType=VARCHAR}, 
      #{deptName,jdbcType=VARCHAR}, #{subDeptCode,jdbcType=VARCHAR}, #{subDeptName,jdbcType=VARCHAR}, 
      #{supplierOid,jdbcType=DECIMAL}, #{supplierCode,jdbcType=VARCHAR}, #{supplierName,jdbcType=VARCHAR}, 
      #{supplierAddr1,jdbcType=VARCHAR}, #{supplierAddr2,jdbcType=VARCHAR}, #{supplierAddr3,jdbcType=VARCHAR}, 
      #{supplierAddr4,jdbcType=VARCHAR}, #{supplierCity,jdbcType=VARCHAR}, #{supplierState,jdbcType=VARCHAR}, 
      #{supplierCtryCode,jdbcType=CHAR}, #{supplierPostalCode,jdbcType=VARCHAR}, #{shipToCode,jdbcType=VARCHAR}, 
      #{shipToName,jdbcType=VARCHAR}, #{shipToAddr1,jdbcType=VARCHAR}, #{shipToAddr2,jdbcType=VARCHAR}, 
      #{shipToAddr3,jdbcType=VARCHAR}, #{shipToAddr4,jdbcType=VARCHAR}, #{shipToCity,jdbcType=VARCHAR}, 
      #{shipToState,jdbcType=VARCHAR}, #{shipToCtryCode,jdbcType=CHAR}, #{shipToPostalCode,jdbcType=VARCHAR}, 
      #{payTermCode,jdbcType=VARCHAR}, #{payTermDesc,jdbcType=VARCHAR}, #{payInstruct,jdbcType=VARCHAR}, 
      #{additionalDiscountAmount,jdbcType=DECIMAL}, #{additionalDiscountPercent,jdbcType=DECIMAL}, 
      #{cashDiscountAmount,jdbcType=DECIMAL}, #{cashDiscountPercent,jdbcType=DECIMAL}, 
      #{invAmountNoVat,jdbcType=DECIMAL}, #{vatAmount,jdbcType=DECIMAL}, #{invAmountWithVat,jdbcType=DECIMAL}, 
      #{vatRate,jdbcType=DECIMAL}, #{invRemarks,jdbcType=VARCHAR}, #{poOid,jdbcType=DECIMAL},#{footerLine1,jdbcType=VARCHAR},
      #{footerLine2,jdbcType=VARCHAR}, #{footerLine3,jdbcType=VARCHAR},#{footerLine4,jdbcType=VARCHAR},#{invStatus,jdbcType=CHAR},
      #{oldInvNo,jdbcType=VARCHAR}, #{deliveryNo,jdbcType=VARCHAR}
      )
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.pracbiz.b2bportal.core.holder.InvHeaderHolder" >
    update INV_HEADER
    <set >
      <if test="invNo != null" >
        INV_NO = #{invNo,jdbcType=VARCHAR},
      </if>
      <if test="docAction != null" >
        DOC_ACTION = #{docAction,jdbcType=CHAR},
      </if>
      <if test="actionDate != null" >
        ACTION_DATE = #{actionDate,jdbcType=TIMESTAMP},
      </if>
      <if test="invType != null" >
        INV_TYPE = #{invType,jdbcType=CHAR},
      </if>
      <if test="invDate != null" >
        INV_DATE = #{invDate,jdbcType=TIMESTAMP},
      </if>
      <if test="poNo != null" >
        PO_NO = #{poNo,jdbcType=VARCHAR},
      </if>
      <if test="poDate != null" >
        PO_DATE = #{poDate,jdbcType=DATE},
      </if>
      <if test="deliveryDate != null" >
        DELIVERY_DATE = #{deliveryDate,jdbcType=TIMESTAMP},
      </if>
      <if test="buyerOid != null" >
        BUYER_OID = #{buyerOid,jdbcType=DECIMAL},
      </if>
      <if test="buyerCode != null" >
        BUYER_CODE = #{buyerCode,jdbcType=VARCHAR},
      </if>
      <if test="buyerName != null" >
        BUYER_NAME = #{buyerName,jdbcType=VARCHAR},
      </if>
      <if test="buyerAddr1 != null" >
        BUYER_ADDR1 = #{buyerAddr1,jdbcType=VARCHAR},
      </if>
      <if test="buyerAddr2 != null" >
        BUYER_ADDR2 = #{buyerAddr2,jdbcType=VARCHAR},
      </if>
      <if test="buyerAddr3 != null" >
        BUYER_ADDR3 = #{buyerAddr3,jdbcType=VARCHAR},
      </if>
      <if test="buyerAddr4 != null" >
        BUYER_ADDR4 = #{buyerAddr4,jdbcType=VARCHAR},
      </if>
      <if test="buyerCity != null" >
        BUYER_CITY = #{buyerCity,jdbcType=VARCHAR},
      </if>
      <if test="buyerState != null" >
        BUYER_STATE = #{buyerState,jdbcType=VARCHAR},
      </if>
      <if test="buyerCtryCode != null" >
        BUYER_CTRY_CODE = #{buyerCtryCode,jdbcType=CHAR},
      </if>
      <if test="buyerPostalCode != null" >
        BUYER_POSTAL_CODE = #{buyerPostalCode,jdbcType=VARCHAR},
      </if>
      <if test="deptCode != null" >
        DEPT_CODE = #{deptCode,jdbcType=VARCHAR},
      </if>
      <if test="deptName != null" >
        DEPT_NAME = #{deptName,jdbcType=VARCHAR},
      </if>
      <if test="subDeptCode != null" >
        SUB_DEPT_CODE = #{subDeptCode,jdbcType=VARCHAR},
      </if>
      <if test="subDeptName != null" >
        SUB_DEPT_NAME = #{subDeptName,jdbcType=VARCHAR},
      </if>
      <if test="supplierOid != null" >
        SUPPLIER_OID = #{supplierOid,jdbcType=DECIMAL},
      </if>
      <if test="supplierCode != null" >
        SUPPLIER_CODE = #{supplierCode,jdbcType=VARCHAR},
      </if>
      <if test="supplierName != null" >
        SUPPLIER_NAME = #{supplierName,jdbcType=VARCHAR},
      </if>
      <if test="supplierAddr1 != null" >
        SUPPLIER_ADDR1 = #{supplierAddr1,jdbcType=VARCHAR},
      </if>
      <if test="supplierAddr2 != null" >
        SUPPLIER_ADDR2 = #{supplierAddr2,jdbcType=VARCHAR},
      </if>
      <if test="supplierAddr3 != null" >
        SUPPLIER_ADDR3 = #{supplierAddr3,jdbcType=VARCHAR},
      </if>
      <if test="supplierAddr4 != null" >
        SUPPLIER_ADDR4 = #{supplierAddr4,jdbcType=VARCHAR},
      </if>
      <if test="supplierCity != null" >
        SUPPLIER_CITY = #{supplierCity,jdbcType=VARCHAR},
      </if>
      <if test="supplierState != null" >
        SUPPLIER_STATE = #{supplierState,jdbcType=VARCHAR},
      </if>
      <if test="supplierCtryCode != null" >
        SUPPLIER_CTRY_CODE = #{supplierCtryCode,jdbcType=CHAR},
      </if>
      <if test="supplierPostalCode != null" >
        SUPPLIER_POSTAL_CODE = #{supplierPostalCode,jdbcType=VARCHAR},
      </if>
      <if test="shipToCode != null" >
        SHIP_TO_CODE = #{shipToCode,jdbcType=VARCHAR},
      </if>
      <if test="shipToName != null" >
        SHIP_TO_NAME = #{shipToName,jdbcType=VARCHAR},
      </if>
      <if test="shipToAddr1 != null" >
        SHIP_TO_ADDR1 = #{shipToAddr1,jdbcType=VARCHAR},
      </if>
      <if test="shipToAddr2 != null" >
        SHIP_TO_ADDR2 = #{shipToAddr2,jdbcType=VARCHAR},
      </if>
      <if test="shipToAddr3 != null" >
        SHIP_TO_ADDR3 = #{shipToAddr3,jdbcType=VARCHAR},
      </if>
      <if test="shipToAddr4 != null" >
        SHIP_TO_ADDR4 = #{shipToAddr4,jdbcType=VARCHAR},
      </if>
      <if test="shipToCity != null" >
        SHIP_TO_CITY = #{shipToCity,jdbcType=VARCHAR},
      </if>
      <if test="shipToState != null" >
        SHIP_TO_STATE = #{shipToState,jdbcType=VARCHAR},
      </if>
      <if test="shipToCtryCode != null" >
        SHIP_TO_CTRY_CODE = #{shipToCtryCode,jdbcType=CHAR},
      </if>
      <if test="shipToPostalCode != null" >
        SHIP_TO_POSTAL_CODE = #{shipToPostalCode,jdbcType=VARCHAR},
      </if>
      <if test="payTermCode != null" >
        PAY_TERM_CODE = #{payTermCode,jdbcType=VARCHAR},
      </if>
      <if test="payTermDesc != null" >
        PAY_TERM_DESC = #{payTermDesc,jdbcType=VARCHAR},
      </if>
      <if test="payInstruct != null" >
        PAY_INSTRUCT = #{payInstruct,jdbcType=VARCHAR},
      </if>
      <if test="additionalDiscountAmount != null" >
        ADDITIONAL_DISCOUNT_AMOUNT = #{additionalDiscountAmount,jdbcType=DECIMAL},
      </if>
      <if test="additionalDiscountPercent != null" >
        ADDITIONAL_DISCOUNT_PERCENT = #{additionalDiscountPercent,jdbcType=DECIMAL},
      </if>
      <if test="cashDiscountAmount != null" >
        CASH_DISCOUNT_AMOUNT = #{cashDiscountAmount,jdbcType=DECIMAL},
      </if>
      <if test="cashDiscountPercent != null" >
        CASH_DISCOUNT_PERCENT = #{cashDiscountPercent,jdbcType=DECIMAL},
      </if>
      <if test="invAmountNoVat != null" >
        INV_AMOUNT_NO_VAT = #{invAmountNoVat,jdbcType=DECIMAL},
      </if>
      <if test="vatAmount != null" >
        VAT_AMOUNT = #{vatAmount,jdbcType=DECIMAL},
      </if>
      <if test="invAmountWithVat != null" >
        INV_AMOUNT_WITH_VAT = #{invAmountWithVat,jdbcType=DECIMAL},
      </if>
      <if test="vatRate != null" >
        VAT_RATE = #{vatRate,jdbcType=DECIMAL},
      </if>
      <if test="invRemarks != null" >
        INV_REMARKS = #{invRemarks,jdbcType=VARCHAR},
      </if>
      <if test="poOid != null" >
        PO_OID = #{poOid,jdbcType=DECIMAL},
      </if>
      <if test="footerLine1 != null" >
        FOOTER_LINE_1 = #{footerLine1,jdbcType=VARCHAR},
      </if>
      <if test="footerLine2 != null" >
        FOOTER_LINE_2 = #{footerLine2,jdbcType=VARCHAR},
      </if>
      <if test="footerLine3 != null" >
        FOOTER_LINE_3 = #{footerLine3,jdbcType=VARCHAR},
      </if>
      <if test="footerLine4 != null" >
        FOOTER_LINE_4 = #{footerLine4,jdbcType=VARCHAR},
      </if>
      <if test="invStatus != null">
      	CTRL_STATUS = #{invStatus,jdbcType=CHAR},
      </if>
      <if test="oldInvNo != null" >
        OLD_INV_NO = #{oldInvNo,jdbcType=VARCHAR},
      </if>
      <if test="deliveryNo != null">
      	DELIVERY_NO = #{deliveryNo,jdbcType=VARCHAR}
      </if>
    </set>
    where INV_OID = #{invOid,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.pracbiz.b2bportal.core.holder.InvHeaderHolder" >
    update INV_HEADER
    set INV_NO = #{invNo,jdbcType=VARCHAR},
      DOC_ACTION = #{docAction,jdbcType=CHAR},
      ACTION_DATE = #{actionDate,jdbcType=TIMESTAMP},
      INV_TYPE = #{invType,jdbcType=CHAR},
      INV_DATE = #{invDate,jdbcType=TIMESTAMP},
      PO_NO = #{poNo,jdbcType=VARCHAR},
      PO_DATE = #{poDate,jdbcType=DATE},
      DELIVERY_DATE = #{deliveryDate,jdbcType=TIMESTAMP},
      BUYER_OID = #{buyerOid,jdbcType=DECIMAL},
      BUYER_CODE = #{buyerCode,jdbcType=VARCHAR},
      BUYER_NAME = #{buyerName,jdbcType=VARCHAR},
      BUYER_ADDR1 = #{buyerAddr1,jdbcType=VARCHAR},
      BUYER_ADDR2 = #{buyerAddr2,jdbcType=VARCHAR},
      BUYER_ADDR3 = #{buyerAddr3,jdbcType=VARCHAR},
      BUYER_ADDR4 = #{buyerAddr4,jdbcType=VARCHAR},
      BUYER_CITY = #{buyerCity,jdbcType=VARCHAR},
      BUYER_STATE = #{buyerState,jdbcType=VARCHAR},
      BUYER_CTRY_CODE = #{buyerCtryCode,jdbcType=CHAR},
      BUYER_POSTAL_CODE = #{buyerPostalCode,jdbcType=VARCHAR},
      DEPT_CODE = #{deptCode,jdbcType=VARCHAR},
      DEPT_NAME = #{deptName,jdbcType=VARCHAR},
      SUB_DEPT_CODE = #{subDeptCode,jdbcType=VARCHAR},
      SUB_DEPT_NAME = #{subDeptName,jdbcType=VARCHAR},
      SUPPLIER_OID = #{supplierOid,jdbcType=DECIMAL},
      SUPPLIER_CODE = #{supplierCode,jdbcType=VARCHAR},
      SUPPLIER_NAME = #{supplierName,jdbcType=VARCHAR},
      SUPPLIER_ADDR1 = #{supplierAddr1,jdbcType=VARCHAR},
      SUPPLIER_ADDR2 = #{supplierAddr2,jdbcType=VARCHAR},
      SUPPLIER_ADDR3 = #{supplierAddr3,jdbcType=VARCHAR},
      SUPPLIER_ADDR4 = #{supplierAddr4,jdbcType=VARCHAR},
      SUPPLIER_CITY = #{supplierCity,jdbcType=VARCHAR},
      SUPPLIER_STATE = #{supplierState,jdbcType=VARCHAR},
      SUPPLIER_CTRY_CODE = #{supplierCtryCode,jdbcType=CHAR},
      SUPPLIER_POSTAL_CODE = #{supplierPostalCode,jdbcType=VARCHAR},
      SHIP_TO_CODE = #{shipToCode,jdbcType=VARCHAR},
      SHIP_TO_NAME = #{shipToName,jdbcType=VARCHAR},
      SHIP_TO_ADDR1 = #{shipToAddr1,jdbcType=VARCHAR},
      SHIP_TO_ADDR2 = #{shipToAddr2,jdbcType=VARCHAR},
      SHIP_TO_ADDR3 = #{shipToAddr3,jdbcType=VARCHAR},
      SHIP_TO_ADDR4 = #{shipToAddr4,jdbcType=VARCHAR},
      SHIP_TO_CITY = #{shipToCity,jdbcType=VARCHAR},
      SHIP_TO_STATE = #{shipToState,jdbcType=VARCHAR},
      SHIP_TO_CTRY_CODE = #{shipToCtryCode,jdbcType=CHAR},
      SHIP_TO_POSTAL_CODE = #{shipToPostalCode,jdbcType=VARCHAR},
      PAY_TERM_CODE = #{payTermCode,jdbcType=VARCHAR},
      PAY_TERM_DESC = #{payTermDesc,jdbcType=VARCHAR},
      PAY_INSTRUCT = #{payInstruct,jdbcType=VARCHAR},
      ADDITIONAL_DISCOUNT_AMOUNT = #{additionalDiscountAmount,jdbcType=DECIMAL},
      ADDITIONAL_DISCOUNT_PERCENT = #{additionalDiscountPercent,jdbcType=DECIMAL},
      CASH_DISCOUNT_AMOUNT = #{cashDiscountAmount,jdbcType=DECIMAL},
      CASH_DISCOUNT_PERCENT = #{cashDiscountPercent,jdbcType=DECIMAL},
      INV_AMOUNT_NO_VAT = #{invAmountNoVat,jdbcType=DECIMAL},
      VAT_AMOUNT = #{vatAmount,jdbcType=DECIMAL},
      INV_AMOUNT_WITH_VAT = #{invAmountWithVat,jdbcType=DECIMAL},
      VAT_RATE = #{vatRate,jdbcType=DECIMAL},
      INV_REMARKS = #{invRemarks,jdbcType=VARCHAR},
      PO_OID = #{poOid,jdbcType=DECIMAL},
      FOOTER_LINE_1 = #{footerLine1,jdbcType=VARCHAR},
      FOOTER_LINE_2 = #{footerLine2,jdbcType=VARCHAR},
      FOOTER_LINE_3 = #{footerLine3,jdbcType=VARCHAR},
      FOOTER_LINE_4 = #{footerLine4,jdbcType=VARCHAR},
      CTRL_STATUS = #{invStatus,jdbcType=CHAR},
      OLD_INV_NO = #{oldInvNo,jdbcType=VARCHAR},
      DELIVERY_NO = #{deliveryNo,jdbcType=VARCHAR}
    where INV_OID = #{invOid,jdbcType=DECIMAL}
  </update>
  
  <select id="selectAllRecordToExport" parameterType="com.pracbiz.b2bportal.core.holder.extension.InvSummaryHolder" resultMap="summaryResultMap">
		SELECT
		<include refid="Grid_Column_List"/>,(SELECT MATCHING_STATUS FROM PO_INV_GRN_DN_MATCHING P WHERE P.INV_OID = I.INV_OID) AS MATCHING_STATUS,
		(SELECT 1 FROM PO_INV_GRN_DN_MATCHING P WHERE P.INV_OID = I.INV_OID) AS IN_MATCHING,
		(SELECT COUNT(*) FROM INV_DETAIL ID WHERE ID.INV_OID = I.INV_OID) AS DETAIL_COUNT
		FROM MSG_TRANSACTIONS M, INV_HEADER I
      	<if test="statusList != null or canBeVoid == true">
      		,PO_INV_GRN_DN_MATCHING PIGD
      	</if>
		<!-- handle group constraint for buyer user. -->
        <if test="(currentUserType == 2 or currentUserType == 4) and visiable == true and fullGroupPriv == false">
	         <if test="listOid != null">
	         ,FAVOURITE_LIST_SUPPLIER FLS
	         </if>
	         <if test="listOid == null">
	         ,GROUP_SUPPLIER GS 
	         </if>
	    </if>
        <!-- handle group constraint for supplier user. -->
        <if test="(currentUserType == 3 or currentUserType == 5) and visiable == true and currentUserGroupOid != null and fullGroupPriv == false">
            ,GROUP_TRADING_PARTNER GTP, TRADING_PARTNER TP
        </if>
        <if test="setOid != null and validSupplierSet == true ">
			, SUPPLIER S
		</if>
		WHERE M.DOC_OID = I.INV_OID
		<if test="invNo != null ">
			AND I.INV_NO like concat('%',#{invNo,jdbcType=VARCHAR},'%')
		</if>
		<if test="poNo != null ">
			AND I.PO_NO like concat('%',#{poNo,jdbcType=VARCHAR},'%')
		</if>
		<if test="shipToCode != null ">
            AND I.SHIP_TO_CODE  = #{shipToCode,jdbcType=VARCHAR}
        </if>
		<if test="sentDateFrom != null">
			<![CDATA[
			AND M.SENT_DATE >= #{sentDateFrom,jdbcType=TIMESTAMP}
			]]>
		</if>
		<if test="sentDateTo != null">
			<![CDATA[
			AND M.SENT_DATE <= #{sentDateTo,jdbcType=TIMESTAMP}
			]]>
		</if>
		<if test="receivedDateFrom != null">
			<![CDATA[
			AND M.CREATE_DATE >= #{receivedDateFrom,jdbcType=TIMESTAMP}
			 ]]>
		</if>
		<if test="receivedDateTo != null">
			<![CDATA[
			AND M.CREATE_DATE <= #{receivedDateTo,jdbcType=TIMESTAMP}
			]]>
		</if>
		<if test="invDateFrom != null">
			<![CDATA[
			AND I.INV_DATE >= #{invDateFrom,jdbcType=TIMESTAMP}
			 ]]>
		</if>
		<if test="invDateTo != null">
			<![CDATA[
			AND I.INV_DATE <= #{invDateTo,jdbcType=TIMESTAMP}
			 ]]>
		</if>
		<if test="poDateFrom != null">
			<![CDATA[
			AND I.PO_DATE >= #{poDateFrom,jdbcType=TIMESTAMP}
			 ]]>
		</if>
		<if test="poDateTo != null">
			<![CDATA[
			AND I.PO_DATE <= #{poDateTo,jdbcType=TIMESTAMP}
			 ]]>
		</if>
		<if test="invType != null">
			AND I.INV_TYPE = #{invType,jdbcType=CHAR}
		</if>
		<if test="invStatus != null">
			AND I.CTRL_STATUS = #{invStatus,jdbcType=CHAR}
		</if>
		<if test="readStatus != null" >
            AND M.READ_STATUS = #{readStatus,jdbcType=VARCHAR}
        </if>
		<!-- handle group constraint for buyer user. -->
        <if test="(currentUserType == 2 or currentUserType == 4) and visiable == true and fullGroupPriv == false">
           <if test="listOid != null">
               AND FLS.LIST_OID = #{listOid,jdbcType=DECIMAL}
               AND I.SUPPLIER_OID = FLS.SUPPLIER_OID
           </if>
           <if test="listOid == null">
                AND GS.GROUP_OID = #{currentUserGroupOid,jdbcType=DECIMAL}
                AND I.SUPPLIER_OID = GS.SUPPLIER_OID
           </if>
        </if>
        <!-- handle group constraint for supplier user. -->
        <if test="(currentUserType == 3 or currentUserType == 5) and visiable == true and currentUserGroupOid != null and fullGroupPriv == false">
            AND GTP.GROUP_OID = #{currentUserGroupOid,jdbcType=DECIMAL}
            AND GTP.TP_OID = TP.TP_OID
            AND TP.BUYER_SUPPLIER_CODE = I.SUPPLIER_CODE
            AND TP.BUYER_OID = I.BUYER_OID
        </if>
        <if test="visiable == false">
           AND 1 = 2
        </if>
        <!-- current is buyer type user or store type user, add restrict by buyer store access -->
        <if test="(currentUserType == 2 or currentUserType == 4 or currentUserType == 6 or currentUserType == 7) and allStoreFlag == false">
          <if test="buyerStoreAccessList != null">
              AND (I.SHIP_TO_CODE IN
              <foreach collection="buyerStoreAccessList" index="index" item="item" open="(" separator="," close=")">
                  #{item}
              </foreach>
              OR I.SHIP_TO_CODE IS NULL)
          </if>
          <if test="buyerStoreAccessList == null">
              AND 1=2
          </if>
        </if>
        <!-- handle new inv for buyer user. -->
		<if test="currentUserType == 2 or currentUserType == 4 or currentUserType == 6 or currentUserType == 7">
			AND I.CTRL_STATUS != 'NEW'
		</if>
        <if test="currentUserBuyerOid != null">
            AND (M.BUYER_OID = #{currentUserBuyerOid,jdbcType=DECIMAL} OR M.BUYER_OID IN 
            (SELECT AAC.COMPANY_OID FROM ALLOWED_ACCESS_COMPANY AAC WHERE AAC.USER_OID=#{currentUserOid,jdbcType=DECIMAL}))
        </if>
        <if test="currentUserSupplierOid != null and supplierOids == null and setOid == null and validSupplierSet == false">
            AND M.SUPPLIER_OID = #{currentUserSupplierOid,jdbcType=DECIMAL}
        </if>
        <if test="supplierOid != null and supplierOid != -1 and supplierOids == null and setOid == null and validSupplierSet == false">
            AND M.SUPPLIER_OID = #{supplierOid,jdbcType=DECIMAL}
        </if>
        <if test="buyerOid != null and buyerOid != -1">
            AND M.BUYER_OID = #{buyerOid,jdbcType=DECIMAL}
        </if>
        <if test="supplierCode != null">
            AND M.SUPPLIER_CODE like concat('%',#{supplierCode,jdbcType=VARCHAR},'%')
        </if>
        <if test="setOid != null and validSupplierSet == true">
			AND S.SUPPLIER_OID = M.SUPPLIER_OID
			AND S.SET_OID = #{setOid,jdbcType=DECIMAL} 
			<if test="supplierOid != null and supplierOid != -1">
				AND S.SUPPLIER_OID = #{supplierOid,jdbcType=DECIMAL}
			</if>
		</if>
		<if test="supplierOids != null">
			AND M.SUPPLIER_OID IN 
		 	<foreach collection="supplierOids" index="index" item="item" open="(" separator="," close=")">
             	#{item}
        	</foreach>
		</if>
        <if test="supplierName != null">
            AND M.SUPPLIER_NAME like concat('%',#{supplierName,jdbcType=VARCHAR},'%')
        </if>
        <if test="statusList != null or canBeVoid == true">
	    	and PIGD.INV_OID = I.INV_OID
	    </if>
	    <if test="canBeVoid == true">
	    	and PIGD.BUYER_STATUS = 'REJECTED'
	    	and I.CTRL_STATUS = 'SUBMIT'
	    </if>
	    <if test="statusList != null and !statusList.isEmpty()">
	      	and PIGD.MATCHING_STATUS IN
	      	<foreach collection="statusList" index="index" item="item" open="(" separator="," close=")">
	      		#{item}
	      	</foreach>
	    </if>
		<if test="sortField != null" >
			order by ${sortField} ${sortOrder}
		</if>
	</select>
</mapper>